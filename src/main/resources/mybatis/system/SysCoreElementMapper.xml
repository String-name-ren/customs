<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.leader.ren.mapper.system.SysCoreElementMapper">
  <resultMap id="BaseResultMap" type="com.leader.ren.model.system.entity.ElementEntity">
    <!--
       WARNING - @mbggenerated
       This element is automatically generated by MyBatis Generator, do not modify.
       This element was generated on Thu May 10 14:29:26 CST 2018.
     -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="parent_id" jdbcType="BIGINT" property="parentId" />
    <result column="menu_id" jdbcType="BIGINT" property="menuId" />
    <result column="type" jdbcType="VARCHAR" property="type" />
    <result column="code" jdbcType="VARCHAR" property="code" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="icon" jdbcType="VARCHAR" property="icon" />
    <result column="href" jdbcType="VARCHAR" property="href" />
    <result column="path" jdbcType="VARCHAR" property="path" />
    <result column="method" jdbcType="VARCHAR" property="method" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="create_by" jdbcType="BIGINT" property="createBy" />
    <result column="create_at" jdbcType="TIMESTAMP" property="createAt" />
    <result column="update_by" jdbcType="BIGINT" property="updateBy" />
    <result column="update_at" jdbcType="TIMESTAMP" property="updateAt" />
    <result column="flag" jdbcType="BOOLEAN" property="flag" />
  </resultMap>

  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 10 14:29:26 CST 2018.
    -->
    id, parent_id, menu_id, `type`, code, `name`, icon, href, `path`, `method`, description,
    `status`, create_by, create_at, update_by, update_at
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 10 14:29:26 CST 2018.
    -->
    select
    <include refid="Base_Column_List" />
    from sys_core_element
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 10 14:29:26 CST 2018.
    -->
    delete from sys_core_element
    where id = #{id,jdbcType=BIGINT}
  </delete>

  <delete id="deleteByMenuId" parameterType="java.lang.Long">
    delete from sys_core_element
    where menu_id = #{menuId,jdbcType=BIGINT}
  </delete>

  <delete id="deleteRelationByMenuId">
    delete from sys_core_relation
    where resource_id in
    <foreach collection="menuIds" item="item" index="index" open="(" close=")" separator=",">
      #{item}
    </foreach>
    and resource_type= #{type,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.leader.ren.model.system.entity.ElementEntity">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 10 14:29:26 CST 2018.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into sys_core_element (parent_id, menu_id, `type`,
    code, `name`, icon, href,
    `path`, `method`, description,
    `status`, create_by, create_at,
    update_by, update_at)
    values (#{parentId,jdbcType=BIGINT}, #{menuId,jdbcType=BIGINT}, #{type,jdbcType=VARCHAR},
    #{code,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{icon,jdbcType=VARCHAR}, #{href,jdbcType=VARCHAR},
    #{path,jdbcType=VARCHAR}, #{method,jdbcType=VARCHAR}, #{description,jdbcType=VARCHAR},
    #{status,jdbcType=INTEGER}, #{createBy,jdbcType=BIGINT}, #{createAt,jdbcType=TIMESTAMP},
    #{updateBy,jdbcType=BIGINT}, #{updateAt,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.leader.ren.model.system.entity.ElementEntity">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 10 14:29:26 CST 2018.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into sys_core_element
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="parentId != null">
        parent_id,
      </if>
      <if test="menuId != null">
        menu_id,
      </if>
      <if test="type != null">
        `type`,
      </if>
      <if test="code != null">
        code,
      </if>
      <if test="name != null">
        `name`,
      </if>
      <if test="icon != null">
        icon,
      </if>
      <if test="href != null">
        href,
      </if>
      <if test="path != null">
        `path`,
      </if>
      <if test="method != null">
        `method`,
      </if>
      <if test="description != null">
        description,
      </if>
      <if test="status != null">
        `status`,
      </if>
      <if test="createBy != null">
        create_by,
      </if>
      <if test="createAt != null">
        create_at,
      </if>
      <if test="updateBy != null">
        update_by,
      </if>
      <if test="updateAt != null">
        update_at,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="parentId != null">
        #{parentId,jdbcType=BIGINT},
      </if>
      <if test="menuId != null">
        #{menuId,jdbcType=BIGINT},
      </if>
      <if test="type != null">
        #{type,jdbcType=VARCHAR},
      </if>
      <if test="code != null">
        #{code,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="icon != null">
        #{icon,jdbcType=VARCHAR},
      </if>
      <if test="href != null">
        #{href,jdbcType=VARCHAR},
      </if>
      <if test="path != null">
        #{path,jdbcType=VARCHAR},
      </if>
      <if test="method != null">
        #{method,jdbcType=VARCHAR},
      </if>
      <if test="description != null">
        #{description,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="createBy != null">
        #{createBy,jdbcType=BIGINT},
      </if>
      <if test="createAt != null">
        #{createAt,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null">
        #{updateBy,jdbcType=BIGINT},
      </if>
      <if test="updateAt != null">
        #{updateAt,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.leader.ren.model.system.entity.ElementEntity">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 10 14:29:26 CST 2018.
    -->
    update sys_core_element
    <set>
      <if test="parentId != null">
        parent_id = #{parentId,jdbcType=BIGINT},
      </if>
      <if test="menuId != null">
        menu_id = #{menuId,jdbcType=BIGINT},
      </if>
      <if test="type != null">
        `type` = #{type,jdbcType=VARCHAR},
      </if>
      <if test="code != null">
        code = #{code,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        `name` = #{name,jdbcType=VARCHAR},
      </if>
      <if test="icon != null">
        icon = #{icon,jdbcType=VARCHAR},
      </if>
      <if test="href != null">
        href = #{href,jdbcType=VARCHAR},
      </if>
      <if test="path != null">
        `path` = #{path,jdbcType=VARCHAR},
      </if>
      <if test="method != null">
        `method` = #{method,jdbcType=VARCHAR},
      </if>
      <if test="description != null">
        description = #{description,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        `status` = #{status,jdbcType=INTEGER},
      </if>
      <if test="createBy != null">
        create_by = #{createBy,jdbcType=BIGINT},
      </if>
      <if test="createAt != null">
        create_at = #{createAt,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null">
        update_by = #{updateBy,jdbcType=BIGINT},
      </if>
      <if test="updateAt != null">
        update_at = #{updateAt,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.leader.ren.model.system.entity.ElementEntity">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 10 14:29:26 CST 2018.
    -->
    update sys_core_element
    set parent_id = #{parentId,jdbcType=BIGINT},
    menu_id = #{menuId,jdbcType=BIGINT},
    `type` = #{type,jdbcType=VARCHAR},
    code = #{code,jdbcType=VARCHAR},
    `name` = #{name,jdbcType=VARCHAR},
    icon = #{icon,jdbcType=VARCHAR},
    href = #{href,jdbcType=VARCHAR},
    `path` = #{path,jdbcType=VARCHAR},
    `method` = #{method,jdbcType=VARCHAR},
    description = #{description,jdbcType=VARCHAR},
    `status` = #{status,jdbcType=INTEGER},
    create_by = #{createBy,jdbcType=BIGINT},
    create_at = #{createAt,jdbcType=TIMESTAMP},
    update_by = #{updateBy,jdbcType=BIGINT},
    update_at = #{updateAt,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>

  <select id="selectSearchData" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 07 15:46:38 CST 2018.
    -->
    select
    <include refid="Base_Column_List" />
    from sys_core_element
    where 1=1
    <if test="params != null" >
      <if test="params.filterText != null" >
        and (code like '%${params.filterText}%'
        or `name` like '%${params.filterText}%'
        or icon like '%${params.filterText}%'
        or `path` like '%${params.filterText}%'
        or description like '%${params.filterText}%'
        )
      </if>
      <if test="params.parentId != null" >
        and parent_id = #{params.parentId,jdbcType=VARCHAR}
      </if>
      <if test="params.menuId != null" >
        and menu_id = #{params.menuId,jdbcType=VARCHAR}
      </if>
      <if test="params.type != null" >
        and `type` = #{params.type,jdbcType=VARCHAR}
      </if>
      <if test="params.code != null" >
        and code like '%${params.code}%'
      </if>
      <if test="params.name != null" >
        and `name` like '%${params.name}%'
      </if>
      <if test="params.icon != null" >
        and icon like '%${params.icon}%'
      </if>
      <if test="params.href != null" >
        and href like '%${params.href}%'
      </if>
      <if test="params.path != null" >
        and `path` like '%${params.path}%'
      </if>
      <if test="params.method != null" >
        and `method` = #{params.method,jdbcType=VARCHAR}
      </if>
      <if test="params.description != null" >
        and description like '%${params.description}%'
      </if>
      <if test="params.status != null" >
        and `status` = #{params.status,jdbcType=INTEGER}
      </if>
    </if>
    <if test="offset != null" >
      limit #{offset} , #{limit}
    </if>
  </select>

  <select id="selectSearchCount" resultType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 07 15:46:38 CST 2018.
    -->
    select count(1)
    from sys_core_element
    where 1=1
    <if test="params != null" >
      <if test="params.filterText != null" >
        and (code like '%${params.filterText}%'
        or `name` like '%${params.filterText}%'
        or icon like '%${params.filterText}%'
        or `path` like '%${params.filterText}%'
        or description like '%${params.filterText}%'
        )
      </if>
      <if test="params.parentId != null" >
        and parent_id = #{params.parentId,jdbcType=VARCHAR}
      </if>
      <if test="params.menuId != null" >
        and menu_id = #{params.menuId,jdbcType=VARCHAR}
      </if>
      <if test="params.type != null" >
        and `type` = #{params.type,jdbcType=VARCHAR}
      </if>
      <if test="params.code != null" >
        and code like '%${params.code}%'
      </if>
      <if test="params.name != null" >
        and `name` like '%${params.name}%'
      </if>
      <if test="params.icon != null" >
        and icon like '%${params.icon}%'
      </if>
      <if test="params.href != null" >
        and href like '%${params.href}%'
      </if>
      <if test="params.path != null" >
        and `path` like '%${params.path}%'
      </if>
      <if test="params.method != null" >
        and `method` = #{params.method,jdbcType=VARCHAR}
      </if>
      <if test="params.description != null" >
        and description like '%${params.description}%'
      </if>
      <if test="params.status != null" >
        and `status` = #{params.status,jdbcType=INTEGER}
      </if>
    </if>
  </select>

  <select id="selectByIds" resultMap="BaseResultMap">
    select
    element.*
    from sys_core_element element
    where element.id in
    <foreach collection="elements" item="item" index="index" open="(" close=")" separator=",">
      #{item}
    </foreach>
  </select>

  <select id="selectByRoleIds" resultMap="BaseResultMap">
    select
    distinct element.*
    from sys_core_relation link
    join sys_core_element element on element.id = link.resource_id and element.status = '1'
    where link.role_id in
    <foreach collection="list" item="roleId" index="index" open="(" close=")" separator=",">
      #{roleId}
    </foreach>
    and link.resource_type = 'element'
  </select>

  <select id="selectByUserId" resultMap="BaseResultMap" parameterType="java.lang.Long">
    select
    distinct element.*
    from sys_core_relation link
    join sys_core_element element on element.id = link.resource_id
    where link.role_id = #{userId,jdbcType=BIGINT}
    and link.resource_type = 'element'
  </select>

  <select id="selectAllElement" parameterType="java.lang.String" resultMap="BaseResultMap">
      select <include refid="Base_Column_List"/> from sys_core_element where status=1 and menu_id in (select id from sys_core_menu where type=#{type})
  </select>

  <select id="selectLinkedElementByLinkId" resultMap="BaseResultMap">
    select
    distinct element.*
    from sys_core_relation link
    join sys_core_element element on element.id = link.resource_id
    join sys_core_role role on role.id = link.role_id
    where element.menu_id = #{menuId,jdbcType=BIGINT}
    and link.role_id = #{roleId,jdbcType=BIGINT}
    and link.resource_type = 'element'
  </select>

  <select id="selectMenuElementByMenuId" resultMap="BaseResultMap">
    select
    element.*
    from sys_core_element element
    where element.menu_id = #{menuId,jdbcType=BIGINT}
  </select>

  <select id="selectUnlinkElementByLinkId" resultMap="BaseResultMap">
    select
    element.*
    from sys_core_element element
    where element.menu_id = #{menuId,jdbcType=BIGINT}
    and element.id not in (
    select
    elementin.id
    from sys_core_relation link
    join sys_core_element elementin on elementin.id = link.resource_id
    join sys_core_role role on role.id = link.role_id
    where link.role_id = #{roleId,jdbcType=BIGINT}
    and link.resource_type = 'element'
    and elementin.menu_id = #{menuId,jdbcType=BIGINT}
    )
  </select>

  <select id="selectLinkedElementByRoleId" resultMap="BaseResultMap">
    select
    distinct element.*
    from sys_core_relation link
    join sys_core_element element on element.id = link.resource_id
    join sys_core_role role on role.id = link.role_id
    where link.role_id = #{roleId,jdbcType=BIGINT}
    and link.resource_type = 'element'
  </select>

  <select id="selectUnlinkElementByRoleId" resultMap="BaseResultMap">
    select
    element.*
    from sys_core_element element
    where element.menu_id in (
      select
      link.resource_id
      from sys_core_relation link
      where link.role_id = #{roleId,jdbcType=BIGINT}
      and link.resource_type = 'menu'
    )
    and element.id not in (
      select
      link.resource_id
      from sys_core_relation link
      where link.role_id = #{roleId,jdbcType=BIGINT}
      and link.resource_type = 'element'
    )
  </select>

  <select id="selectData" resultMap="BaseResultMap">
    select * from (
    select
    distinct element.*,'true' AS flag
    from sys_core_relation link
    join sys_core_element element on element.id = link.resource_id
    join sys_core_role role on role.id = link.role_id
    where link.role_id = #{params.roleId,jdbcType=BIGINT}
    and link.resource_type = 'element'
    UNION
    (select
    element.*,'false' AS flag
    from sys_core_element element
    where element.menu_id in (
    select
    link.resource_id
    from sys_core_relation link
    where link.role_id = #{params.roleId,jdbcType=BIGINT}
    and link.resource_type = 'menu'
    )
    and element.id not in (
    select
    link.resource_id
    from sys_core_relation link
    where link.role_id = #{params.roleId,jdbcType=BIGINT}
    and link.resource_type = 'element'
    ))) elementResult WHERE 1=1
    <if test="params.filterText != ''" >
      and (code like '%${params.filterText}%'
      or `name` like '%${params.filterText}%'
      or description like '%${params.filterText}%'
      )
    </if>
    <if test="params.flag != null" >
      and `flag` = '${params.flag}'
    </if>
    <if test="offset != null" >
      limit #{offset} , #{limit}
    </if>
  </select>

  <select id="selectDataCount" resultType="java.lang.Long">
    SELECT count(1) FROM (
    select * from (
    select
    distinct element.*,'true' AS flag
    from sys_core_relation link
    join sys_core_element element on element.id = link.resource_id
    join sys_core_role role on role.id = link.role_id
    where link.role_id = #{params.roleId,jdbcType=BIGINT}
    and link.resource_type = 'element'
    UNION
    (select
    element.*,'false' AS flag
    from sys_core_element element
    where element.menu_id in (
    select
    link.resource_id
    from sys_core_relation link
    where link.role_id = #{params.roleId,jdbcType=BIGINT}
    and link.resource_type = 'menu'
    )
    and element.id not in (
    select
    link.resource_id
    from sys_core_relation link
    where link.role_id = #{params.roleId,jdbcType=BIGINT}
    and link.resource_type = 'element'
    ))) elementResult WHERE 1=1
    <if test="params.filterText != ''">
      and (code like '%${params.filterText}%'
      or `name` like '%${params.filterText}%'
      or description like '%${params.filterText}%'
      )
    </if>
    <if test="params.flag != null">
      and `flag` = '${params.flag}'
    </if>) result
  </select>

  <select id="selectElementBySelective" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from sys_core_element
    <where>
      <if test="entity != null" >
        <if test="entity.id != null" >
          and id = #{entity.id,jdbcType=BIGINT}
        </if>
        <if test="entity.parentId != null" >
          and parent_id = #{entity.parentId,jdbcType=VARCHAR}
        </if>
        <if test="entity.menuId != null" >
          and menu_id = #{entity.menuId,jdbcType=VARCHAR}
        </if>
        <if test="entity.type != null" >
          and `type` = #{entity.type,jdbcType=VARCHAR}
        </if>
        <if test="entity.code != null" >
          and code = #{entity.code,jdbcType=VARCHAR}
        </if>
        <if test="entity.name != null" >
          and `name` = #{entity.name,jdbcType=VARCHAR}
        </if>
        <if test="entity.icon != null" >
          and icon = #{entity.icon,jdbcType=VARCHAR}
        </if>
        <if test="entity.href != null" >
          and href = #{entity.href,jdbcType=VARCHAR}
        </if>
        <if test="entity.path != null" >
          and `path` = #{entity.path,jdbcType=VARCHAR}
        </if>
        <if test="entity.method != null" >
          and `method` = #{entity.method,jdbcType=VARCHAR}
        </if>
        <if test="entity.status != null" >
          and `status` = #{entity.status,jdbcType=INTEGER}
        </if>
      </if>
    </where>
  </select>


  <select id="getElementByCode" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from sys_core_element
    where  code in
        <foreach collection="elementCode" item="item" index="index" open="(" close=")" separator=",">
          #{item}
        </foreach>
  </select>



  <select id="existRoleIdAndElementId" resultType="int">
    select count(1) from sys_core_relation where
    resource_type = 'element' and status = 1
    and resource_id =  #{resourceId,jdbcType=BIGINT}
    and role_id in
    <foreach collection="roleIdList" item="item" index="index" open="(" close=")" separator=",">
      #{item}
    </foreach>
  </select>
</mapper>